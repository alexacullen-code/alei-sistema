<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ALEI ‚Äì Sistema de Gesti√≥n Integral 2026</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { font-family: 'Inter', sans-serif; background: #f1f5f9; }
    .uk-gradient { background: linear-gradient(135deg, #012169 0%, #1e3a8a 100%); }
    .uk-red { background: linear-gradient(135deg, #C8102E 0%, #9b1c31 100%); }
    .glass { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
    .card-hover { transition: all 0.3s ease; }
    .card-hover:hover { transform: translateY(-2px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
    .animate-fade { animation: fadeIn 0.3s ease-in; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .status-badge { @apply px-3 py-1 rounded-full text-xs font-bold; }
    .status-pagado { background: #dcfce7; color: #166534; }
    .status-parcial { background: #dbeafe; color: #1e40af; }
    .status-pendiente { background: #fee2e2; color: #991b1b; }
    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 50; backdrop-filter: blur(4px); }
    .modal.active { display: flex; align-items: center; justify-content: center; }
    .progress-ring { transform: rotate(-90deg); }
    .toast { position: fixed; bottom: 20px; right: 20px; padding: 16px 24px; border-radius: 12px; color: white; font-weight: 500; z-index: 100; transform: translateX(400px); transition: transform 0.3s; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.2); }
    .toast.show { transform: translateX(0); }
    .section-active { display: block; animation: fadeIn 0.3s; }
    .section-hidden { display: none; }
    input, select, textarea { @apply w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition; }
    .btn-primary { @apply bg-blue-700 hover:bg-blue-800 text-white font-semibold py-2 px-4 rounded-lg transition shadow-lg shadow-blue-500/30; }
    .btn-secondary { @apply bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg transition; }
    .btn-success { @apply bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition shadow-lg shadow-green-500/30; }
    .btn-danger { @apply bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition shadow-lg shadow-red-500/30; }
    .btn-warning { @apply bg-amber-500 hover:bg-amber-600 text-white font-semibold py-2 px-4 rounded-lg transition; }
  </style>
</head>
<body class="text-gray-800">

  <!-- Header -->
  <header class="uk-gradient text-white shadow-2xl sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center gap-4">
        <svg class="w-12 h-8 shadow-lg" viewBox="0 0 60 30" xmlns="http://www.w3.org/2000/svg">
          <rect width="60" height="30" fill="#012169"/>
          <path d="M0,0 L60,30 M60,0 L0,30" stroke="#fff" stroke-width="6"/>
          <path d="M0,0 L60,30 M60,0 L0,30" stroke="#C8102E" stroke-width="4"/>
          <path d="M30,0 V30 M0,15 H60" stroke="#fff" stroke-width="10"/>
          <path d="M30,0 V30 M0,15 H60" stroke="#C8102E" stroke-width="6"/>
        </svg>
        <div>
          <h1 class="text-2xl font-bold tracking-tight">ALEI ‚Äì Instituto de Ingl√©s</h1>
          <p class="text-blue-200 text-sm">Sistema de Gesti√≥n Integral v3.0</p>
        </div>
      </div>
      <div class="flex items-center gap-4">
        <div class="text-right hidden md:block">
          <div id="current-date" class="font-semibold"></div>
          <div id="current-time" class="text-sm text-blue-200"></div>
        </div>
        <button onclick="mostrarSeccion('config')" class="p-2 hover:bg-white/10 rounded-lg transition">
          <i class="fas fa-cog text-xl"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- Navigation -->
  <nav class="bg-white shadow-md sticky top-20 z-30">
    <div class="max-w-7xl mx-auto px-4">
      <div class="flex space-x-1 overflow-x-auto py-2">
        <button onclick="mostrarSeccion('dashboard')" class="nav-btn px-4 py-2 rounded-lg font-medium text-gray-600 hover:bg-blue-50 hover:text-blue-700 transition whitespace-nowrap active" data-section="dashboard">
          <i class="fas fa-chart-line mr-2"></i>Dashboard
        </button>
        <button onclick="mostrarSeccion('alumnos')" class="nav-btn px-4 py-2 rounded-lg font-medium text-gray-600 hover:bg-blue-50 hover:text-blue-700 transition whitespace-nowrap" data-section="alumnos">
          <i class="fas fa-users mr-2"></i>Alumnos
        </button>
        <button onclick="mostrarSeccion('pagos')" class="nav-btn px-4 py-2 rounded-lg font-medium text-gray-600 hover:bg-blue-50 hover:text-blue-700 transition whitespace-nowrap" data-section="pagos">
          <i class="fas fa-cash-register mr-2"></i>Registro de Pagos
        </button>
        <button onclick="mostrarSeccion('libros')" class="nav-btn px-4 py-2 rounded-lg font-medium text-gray-600 hover:bg-blue-50 hover:text-blue-700 transition whitespace-nowrap" data-section="libros">
          <i class="fas fa-book mr-2"></i>Libros
        </button>
        <button onclick="mostrarSeccion('reportes')" class="nav-btn px-4 py-2 rounded-lg font-medium text-gray-600 hover:bg-blue-50 hover:text-blue-700 transition whitespace-nowrap" data-section="reportes">
          <i class="fas fa-file-invoice-dollar mr-2"></i>Reportes
        </button>
        <button onclick="mostrarSeccion('backup')" class="nav-btn px-4 py-2 rounded-lg font-medium text-gray-600 hover:bg-blue-50 hover:text-blue-700 transition whitespace-nowrap" data-section="backup">
          <i class="fas fa-database mr-2"></i>Backup/Restore
        </button>
      </div>
    </div>
  </nav>

  <main class="max-w-7xl mx-auto px-4 py-6 space-y-6">

    <!-- DASHBOARD -->
    <section id="dashboard" class="section-active animate-fade">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <div class="bg-white rounded-xl p-6 shadow-lg border-l-4 border-blue-600 card-hover">
          <div class="flex justify-between items-start">
            <div>
              <p class="text-gray-500 text-sm font-medium">Total Alumnos</p>
              <p class="text-3xl font-bold text-gray-800 mt-1" id="dash-total-alumnos">0</p>
            </div>
            <div class="bg-blue-100 p-3 rounded-lg">
              <i class="fas fa-users text-blue-600 text-xl"></i>
            </div>
          </div>
        </div>
        
        <div class="bg-white rounded-xl p-6 shadow-lg border-l-4 border-green-500 card-hover">
          <div class="flex justify-between items-start">
            <div>
              <p class="text-gray-500 text-sm font-medium">Ingresos Mes Actual</p>
              <p class="text-3xl font-bold text-gray-800 mt-1" id="dash-ingresos-mes">$0</p>
            </div>
            <div class="bg-green-100 p-3 rounded-lg">
              <i class="fas fa-arrow-up text-green-600 text-xl"></i>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-xl p-6 shadow-lg border-l-4 border-red-500 card-hover">
          <div class="flex justify-between items-start">
            <div>
              <p class="text-gray-500 text-sm font-medium">Deuda Total</p>
              <p class="text-3xl font-bold text-gray-800 mt-1" id="dash-deuda-total">$0</p>
            </div>
            <div class="bg-red-100 p-3 rounded-lg">
              <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-xl p-6 shadow-lg border-l-4 border-amber-500 card-hover">
          <div class="flex justify-between items-start">
            <div>
              <p class="text-gray-500 text-sm font-medium">Pagos Parciales</p>
              <p class="text-3xl font-bold text-gray-800 mt-1" id="dash-pagos-parciales">0</p>
            </div>
            <div class="bg-amber-100 p-3 rounded-lg">
              <i class="fas fa-clock text-amber-600 text-xl"></i>
            </div>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
            <i class="fas fa-alert-circle text-red-500 mr-2"></i>
            Deudores Pendientes
          </h3>
          <div id="dash-lista-deudores" class="space-y-3 max-h-96 overflow-y-auto">
            <p class="text-gray-400 text-center py-8">No hay deudas registradas</p>
          </div>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
            <i class="fas fa-book-open text-blue-500 mr-2"></i>
            Libros con Saldo Pendiente
          </h3>
          <div id="dash-libros-pendientes" class="space-y-3 max-h-96 overflow-y-auto">
            <p class="text-gray-400 text-center py-8">No hay libros pendientes</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ALUMNOS -->
    <section id="alumnos" class="section-hidden">
      <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-xl font-bold text-gray-800" id="titulo-form-alumno">Nuevo Alumno</h2>
          <button onclick="resetFormAlumno()" class="text-gray-500 hover:text-gray-700">
            <i class="fas fa-times"></i> Cancelar
          </button>
        </div>

        <form id="form-alumno" onsubmit="guardarAlumno(event)" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <input type="hidden" id="alumno-id">
          
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-1">Nombre Completo *</label>
            <input type="text" id="alumno-nombre" required placeholder="Apellido Nombre">
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">N¬∞ Anual</label>
            <input type="number" id="alumno-numero" readonly class="bg-gray-100">
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">C√©dula *</label>
            <input type="text" id="alumno-cedula" required placeholder="X.XXX.XXX-X">
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Tel√©fono</label>
            <input type="text" id="alumno-telefono" placeholder="09X XXX XXX">
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Edad</label>
            <input type="number" id="alumno-edad" min="3" max="100">
          </div>

          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-1">Direcci√≥n</label>
            <input type="text" id="alumno-direccion" placeholder="Calle, n√∫mero, barrio">
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Nivel *</label>
            <select id="alumno-nivel" required>
              <option value="">Seleccionar...</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Tipo Matr√≠cula *</label>
            <select id="alumno-tipo-matricula" required>
              <option value="">Seleccionar...</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Fecha Inscripci√≥n *</label>
            <input type="date" id="alumno-fecha" required>
          </div>

          <div class="md:col-span-3 flex gap-3">
            <button type="submit" class="btn-primary flex-1">
              <i class="fas fa-save mr-2"></i>Guardar Alumno
            </button>
            <button type="button" onclick="resetFormAlumno()" class="btn-secondary">
              <i class="fas fa-undo mr-2"></i>Limpiar
            </button>
          </div>
        </form>
      </div>

      <div class="bg-white rounded-xl shadow-lg p-6">
        <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
          <h3 class="text-lg font-bold text-gray-800">Lista de Alumnos</h3>
          <div class="flex gap-2 w-full md:w-auto">
            <input type="text" id="buscar-alumno" oninput="buscarAlumnos()" placeholder="Buscar alumno..." class="md:w-64">
            <button onclick="exportarSeccion('alumnos')" class="btn-success">
              <i class="fas fa-download"></i>
            </button>
          </div>
        </div>

        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">N¬∞</th>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Nombre</th>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">C√©dula</th>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Nivel</th>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Matr√≠cula</th>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Deuda</th>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Acciones</th>
              </tr>
            </thead>
            <tbody id="tabla-alumnos" class="divide-y divide-gray-100">
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- PAGOS -->
    <section id="pagos" class="section-hidden">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-bold text-gray-800 mb-4">Buscar Alumno</h3>
          <input type="text" id="pago-buscar" oninput="buscarAlumnoParaPago()" placeholder="Nombre o c√©dula..." class="mb-4">
          <div id="pago-resultados" class="space-y-2 max-h-96 overflow-y-auto"></div>
        </div>

        <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6 hidden" id="panel-pago">
          <h3 class="text-lg font-bold text-gray-800 mb-4">Registrar Pago</h3>
          
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
            <div class="font-bold text-blue-900" id="pago-alumno-info"></div>
            <div class="text-sm text-blue-700" id="pago-alumno-detalle"></div>
          </div>

          <form id="form-pago" onsubmit="guardarPago(event)" class="space-y-4">
            <input type="hidden" id="pago-alumno-id">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Concepto *</label>
                <select id="pago-concepto" onchange="cambiarConceptoPago()" required>
                  <option value="">Seleccionar...</option>
                  <option value="matricula">üéì Matr√≠cula</option>
                  <option value="mensualidad">üìÖ Mensualidad</option>
                  <option value="libro">üìö Libro/Material</option>
                  <option value="examen">üìù Examen</option>
                  <option value="otro">üíº Otro</option>
                </select>
              </div>

              <div id="campo-mes" class="hidden">
                <label class="block text-sm font-medium text-gray-700 mb-1">Mes *</label>
                <select id="pago-mes">
                  <option value="1">Enero</option>
                  <option value="2">Febrero</option>
                  <option value="3">Marzo</option>
                  <option value="4">Abril</option>
                  <option value="5">Mayo</option>
                  <option value="6">Junio</option>
                  <option value="7">Julio</option>
                  <option value="8">Agosto</option>
                  <option value="9">Septiembre</option>
                  <option value="10">Octubre</option>
                  <option value="11">Noviembre</option>
                  <option value="12">Diciembre</option>
                </select>
              </div>

              <div id="campo-libro" class="hidden md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1">Libro *</label>
                <select id="pago-libro-id" onchange="actualizarSaldoLibro()">
                </select>
                <div id="info-libro-saldo" class="mt-2 p-3 bg-yellow-50 rounded-lg text-sm hidden">
                  <div class="flex justify-between">
                    <span>Costo total:</span>
                    <span class="font-bold" id="libro-costo-total"></span>
                  </div>
                  <div class="flex justify-between text-green-600">
                    <span>Ya pagado:</span>
                    <span class="font-bold" id="libro-pagado"></span>
                  </div>
                  <div class="flex justify-between text-red-600 font-bold border-t border-yellow-200 pt-1 mt-1">
                    <span>Saldo pendiente:</span>
                    <span id="libro-saldo"></span>
                  </div>
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Monto a pagar *</label>
                <input type="number" id="pago-monto" min="1" required>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Fecha *</label>
                <input type="date" id="pago-fecha" required>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Comentarios / Observaciones</label>
              <textarea id="pago-comentarios" rows="2" placeholder="Ej: Abona $500, falta el resto para el pr√≥ximo mes. O: Pag√≥ $100 de m√°s, se le descontar√° despu√©s..."></textarea>
            </div>

            <div class="flex gap-3">
              <button type="submit" class="btn-primary flex-1">
                <i class="fas fa-check mr-2"></i>Registrar Pago
              </button>
              <button type="button" onclick="cerrarPanelPago()" class="btn-secondary">
                Cancelar
              </button>
            </div>
          </form>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow-lg p-6 mt-6">
        <h3 class="text-lg font-bold text-gray-800 mb-4">√öltimos Pagos Registrados</h3>
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Fecha</th>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Alumno</th>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Concepto</th>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Monto</th>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Comentarios</th>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Acciones</th>
              </tr>
            </thead>
            <tbody id="tabla-pagos" class="divide-y divide-gray-100">
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- LIBROS -->
    <section id="libros" class="section-hidden">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-bold text-gray-800 mb-4">Asignar Libro a Alumno</h3>
          
          <div class="mb-4">
            <input type="text" id="libro-buscar-alumno" oninput="buscarAlumnoParaLibro()" placeholder="Buscar alumno..." class="mb-2">
            <div id="libro-resultados-alumno" class="space-y-2 max-h-48 overflow-y-auto"></div>
          </div>

          <form id="form-libro" onsubmit="asignarLibro(event)" class="space-y-4 hidden">
            <input type="hidden" id="libro-alumno-id">
            
            <div class="bg-gray-50 p-3 rounded-lg">
              <div class="font-semibold" id="libro-alumno-nombre"></div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">T√≠tulo del Libro *</label>
              <input type="text" id="libro-titulo" required placeholder="Ej: Wider World 2 Student's Book">
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Costo Total *</label>
                <input type="number" id="libro-costo" required min="1" onchange="calcularSaldoInicial()">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Primer Abono</label>
                <input type="number" id="libro-abono" min="0" value="0" onchange="calcularSaldoInicial()">
              </div>
            </div>

            <div class="p-3 bg-amber-50 rounded-lg border border-amber-200">
              <div class="flex justify-between font-bold text-amber-800">
                <span>Saldo a financiar:</span>
                <span id="libro-saldo-inicial">$0</span>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Observaciones</label>
              <textarea id="libro-observaciones" rows="2"></textarea>
            </div>

            <button type="submit" class="btn-primary w-full">
              <i class="fas fa-plus mr-2"></i>Asignar Libro
            </button>
          </form>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-6">
          <h3 class="text-lg font-bold text-gray-800 mb-4">Resumen de Libros</h3>
          <div id="resumen-libros-stats" class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
              <div class="bg-blue-50 p-4 rounded-lg text-center">
                <div class="text-2xl font-bold text-blue-700" id="stat-total-libros">0</div>
                <div class="text-sm text-blue-600">Total Libros</div>
              </div>
              <div class="bg-green-50 p-4 rounded-lg text-center">
                <div class="text-2xl font-bold text-green-700" id="stat-libros-pagados">0</div>
                <div class="text-sm text-green-600">Pagados</div>
              </div>
              <div class="bg-amber-50 p-4 rounded-lg text-center">
                <div class="text-2xl font-bold text-amber-700" id="stat-libros-parciales">0</div>
                <div class="text-sm text-amber-600">Parciales</div>
              </div>
              <div class="bg-red-50 p-4 rounded-lg text-center">
                <div class="text-2xl font-bold text-red-700" id="stat-deuda-libros">$0</div>
                <div class="text-sm text-red-600">Deuda Total</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow-lg p-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-bold text-gray-800">Libros Activos</h3>
          <button onclick="exportarSeccion('libros')" class="btn-success">
            <i class="fas fa-download mr-2"></i>Exportar
          </button>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Alumno</th>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Libro</th>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Costo</th>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Pagado</th>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Saldo</th>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Estado</th>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Acciones</th>
              </tr>
            </thead>
            <tbody id="tabla-libros" class="divide-y divide-gray-100">
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- REPORTES -->
    <section id="reportes" class="section-hidden">
      <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
        <h3 class="text-lg font-bold text-gray-800 mb-4">Filtros de Reporte</h3>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Desde</label>
            <input type="date" id="reporte-desde">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Hasta</label>
            <input type="date" id="reporte-hasta">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Concepto</label>
            <select id="reporte-concepto">
              <option value="todos">Todos</option>
              <option value="matricula">Matr√≠cula</option>
              <option value="mensualidad">Mensualidad</option>
              <option value="libro">Libro</option>
              <option value="examen">Examen</option>
            </select>
          </div>
          <div class="flex items-end">
            <button onclick="generarReporte()" class="btn-primary w-full">
              <i class="fas fa-search mr-2"></i>Generar Reporte
            </button>
          </div>
        </div>
      </div>

      <div id="resultado-reporte" class="hidden space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="bg-white rounded-xl shadow p-6 text-center">
            <div class="text-3xl font-bold text-green-600" id="reporte-total">$0</div>
            <div class="text-gray-500">Total Ingresos</div>
          </div>
          <div class="bg-white rounded-xl shadow p-6 text-center">
            <div class="text-3xl font-bold text-blue-600" id="reporte-cantidad">0</div>
            <div class="text-gray-500">Cantidad de Pagos</div>
          </div>
          <div class="bg-white rounded-xl shadow p-6 text-center">
            <div class="text-3xl font-bold text-purple-600" id="reporte-promedio">$0</div>
            <div class="text-gray-500">Promedio por Pago</div>
          </div>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-6">
          <h4 class="font-bold text-gray-800 mb-4">Detalle de Movimientos</h4>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Fecha</th>
                  <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Alumno</th>
                  <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Concepto</th>
                  <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Monto</th>
                  <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Comentarios</th>
                </tr>
              </thead>
              <tbody id="tabla-reporte" class="divide-y divide-gray-100">
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- BACKUP / CONFIG -->
    <section id="backup" class="section-hidden">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div class="bg-white rounded-xl shadow-lg p-6 border-t-4 border-green-500">
          <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
            <i class="fas fa-download text-green-500 mr-2"></i>
            Exportar Datos (Backup)
          </h3>
          <p class="text-gray-600 mb-4 text-sm">Descarga la informaci√≥n por secciones o completa.</p>
          
          <div class="space-y-2">
            <button onclick="exportarSeccion('completo')" class="w-full btn-primary mb-2">
              <i class="fas fa-database mr-2"></i>Backup Completo
            </button>
            <div class="grid grid-cols-2 gap-2">
              <button onclick="exportarSeccion('alumnos')" class="btn-secondary text-sm py-2">
                <i class="fas fa-users mr-1"></i>Solo Alumnos
              </button>
              <button onclick="exportarSeccion('libros')" class="btn-secondary text-sm py-2">
                <i class="fas fa-book mr-1"></i>Solo Libros
              </button>
              <button onclick="exportarSeccion('pagos')" class="btn-secondary text-sm py-2">
                <i class="fas fa-money-bill mr-1"></i>Solo Pagos
              </button>
              <button onclick="exportarSeccion('gastos')" class="btn-secondary text-sm py-2">
                <i class="fas fa-receipt mr-1"></i>Solo Gastos
              </button>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-6 border-t-4 border-blue-500">
          <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
            <i class="fas fa-upload text-blue-500 mr-2"></i>
            Importar Datos (Restore)
          </h3>
          <p class="text-gray-600 mb-4 text-sm">Restaura informaci√≥n desde archivos JSON.</p>
          
          <div class="space-y-3">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Seleccionar archivo JSON</label>
              <input type="file" id="importar-archivo" accept=".json" onchange="importarDatos(this)" class="text-sm">
            </div>
            <div class="flex items-center gap-2">
              <input type="checkbox" id="importar-modo" class="w-4 h-4">
              <label for="importar-modo" class="text-sm text-gray-600">Modo fusi√≥n (no borrar datos existentes)</label>
            </div>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-xl shadow-lg p-6 border-t-4 border-red-500">
        <h3 class="text-lg font-bold text-red-600 mb-4 flex items-center">
          <i class="fas fa-exclamation-triangle mr-2"></i>
          Zona de Peligro - Reset de Sistema
        </h3>
        <p class="text-gray-600 mb-4 text-sm">
          Esta acci√≥n eliminar√° TODOS los datos del sistema. Es recomendable hacer un backup antes de proceder.
          Use esta funci√≥n al iniciar un nuevo a√±o lectivo.
        </p>
        
        <div id="reset-paso-1">
          <button onclick="iniciarReset()" class="btn-danger w-full md:w-auto">
            <i class="fas fa-trash-alt mr-2"></i>Iniciar Reset del Sistema
          </button>
        </div>
        
        <div id="reset-paso-2" class="hidden space-y-4">
          <div class="bg-red-50 border border-red-200 rounded-lg p-4">
            <p class="font-bold text-red-800 mb-2">‚ö†Ô∏è Advertencia Final</p>
            <p class="text-red-700 text-sm mb-3">
              Est√° a punto de borrar todos los alumnos, pagos, libros y configuraciones. 
              Esta acci√≥n no se puede deshacer.
            </p>
            <p class="text-red-700 text-sm font-bold">
              Para confirmar, escriba "ELIMINAR TODO" en el campo de abajo:
            </p>
          </div>
          <input type="text" id="reset-confirmacion" placeholder="Escriba ELIMINAR TODO" class="border-red-300 focus:ring-red-500">
          <div class="flex gap-3">
            <button onclick="ejecutarReset()" class="btn-danger flex-1">
              <i class="fas fa-bomb mr-2"></i>S√≠, Borrar Todo
            </button>
            <button onclick="cancelarReset()" class="btn-secondary">
              Cancelar
            </button>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- Modal Editar Pago -->
  <div class="modal" id="modal-editar-pago">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg mx-4 p-6">
      <h3 class="text-xl font-bold text-gray-800 mb-4">Editar Pago</h3>
      <form id="form-editar-pago" onsubmit="actualizarPago(event)" class="space-y-4">
        <input type="hidden" id="edit-pago-id">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Monto</label>
          <input type="number" id="edit-pago-monto" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Fecha</label>
          <input type="date" id="edit-pago-fecha" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Comentarios</label>
          <textarea id="edit-pago-comentarios" rows="2"></textarea>
        </div>
        <div class="flex gap-3 pt-4">
          <button type="submit" class="btn-primary flex-1">Guardar Cambios</button>
          <button type="button" onclick="cerrarModal('modal-editar-pago')" class="btn-secondary">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Abono Libro -->
  <div class="modal" id="modal-abono-libro">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 p-6">
      <h3 class="text-xl font-bold text-gray-800 mb-4">Registrar Abono</h3>
      <div id="abono-info-libro" class="mb-4 p-4 bg-blue-50 rounded-lg"></div>
      <form id="form-abono" onsubmit="registrarAbonoLibro(event)" class="space-y-4">
        <input type="hidden" id="abono-libro-id">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Monto del Abono</label>
          <input type="number" id="abono-monto" required min="1">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Comentarios</label>
          <textarea id="abono-comentarios" rows="2"></textarea>
        </div>
        <div class="flex gap-3">
          <button type="submit" class="btn-primary flex-1">Registrar Abono</button>
          <button type="button" onclick="cerrarModal('modal-abono-libro')" class="btn-secondary">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Ver Pagos Libro -->
  <div class="modal" id="modal-historial-libro">
    <div class="bg-white rounded-xl shadow-2xl w-full max-lg max-w-2xl mx-4 p-6 max-h-[90vh] overflow-y-auto">
      <h3 class="text-xl font-bold text-gray-800 mb-4">Historial de Pagos del Libro</h3>
      <div id="historial-libro-info" class="mb-4 p-4 bg-gray-50 rounded-lg"></div>
      <div id="historial-libro-lista" class="space-y-2 mb-4"></div>
      <button onclick="cerrarModal('modal-historial-libro')" class="btn-secondary w-full">Cerrar</button>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <script>
    // === ESTADO GLOBAL ===
    const DB = {
      get: (key) => {
        const data = localStorage.getItem(`alei_${key}`);
        return data ? JSON.parse(data) : null;
      },
      set: (key, value) => localStorage.setItem(`alei_${key}`, JSON.stringify(value)),
      init: () => {
        if (!DB.get('niveles')) DB.set('niveles', []);
        if (!DB.get('alumnos')) DB.set('alumnos', []);
        if (!DB.get('libros')) DB.set('libros', []);
        if (!DB.get('pagos')) DB.set('pagos', []);
        if (!DB.get('gastos')) DB.set('gastos', []);
        if (!DB.get('tiposMatricula')) {
          DB.set('tiposMatricula', [
            { id: 1, nombre: 'Regular', costo: 1500, descripcion: 'Matr√≠cula est√°ndar' },
            { id: 2, nombre: 'Matricula x 2', costo: 1250, descripcion: 'Dos hermanos' },
            { id: 3, nombre: 'Matricula x 3', costo: 1300, descripcion: 'Tres hermanos' }
          ]);
        }
      }
    };

    // === UTILIDADES ===
    const Utils = {
      id: () => Date.now().toString(36) + Math.random().toString(36).substr(2),
      fecha: () => new Date().toISOString().split('T')[0],
      fechaDisplay: (f) => new Date(f).toLocaleDateString('es-UY'),
      money: (n) => '$' + (n || 0).toLocaleString('es-UY'),
      toast: (msg, type = 'success') => {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.className = `toast ${type === 'error' ? 'bg-red-600' : 'bg-green-600'}`;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3000);
      },
      confirm: (msg) => window.confirm(msg)
    };

    // === NAVEGACI√ìN ===
    function mostrarSeccion(seccion) {
      document.querySelectorAll('section').forEach(s => {
        s.classList.remove('section-active');
        s.classList.add('section-hidden');
      });
      document.getElementById(seccion).classList.remove('section-hidden');
      document.getElementById(seccion).classList.add('section-active');
      
      document.querySelectorAll('.nav-btn').forEach(b => {
        b.classList.remove('active', 'bg-blue-50', 'text-blue-700');
        if (b.dataset.section === seccion) {
          b.classList.add('active', 'bg-blue-50', 'text-blue-700');
        }
      });

      if (seccion === 'dashboard') actualizarDashboard();
      if (seccion === 'alumnos') cargarAlumnos();
      if (seccion === 'libros') cargarLibros();
      if (seccion === 'pagos') cargarPagos();
      if (seccion === 'reportes') {
        document.getElementById('reporte-desde').value = Utils.fecha();
        document.getElementById('reporte-hasta').value = Utils.fecha();
      }
    }

    // === DASHBOARD ===
    function actualizarDashboard() {
      const alumnos = DB.get('alumnos') || [];
      const libros = DB.get('libros') || [];
      const pagos = DB.get('pagos') || [];
      const tipos = DB.get('tiposMatricula') || [];

      // Stats
      document.getElementById('dash-total-alumnos').textContent = alumnos.length;
      
      const mesActual = new Date().getMonth() + 1;
      const ingresosMes = pagos
        .filter(p => new Date(p.fecha).getMonth() + 1 === mesActual)
        .reduce((sum, p) => sum + (parseFloat(p.monto) || 0), 0);
      document.getElementById('dash-ingresos-mes').textContent = Utils.money(ingresosMes);

      // Calcular deudas
      let deudaMatriculas = 0;
      alumnos.forEach(a => {
        const tipo = tipos.find(t => t.id == a.tipo_matricula_id) || tipos[0];
        const pagosMat = pagos.filter(p => p.alumno_id == a.id && p.concepto === 'matricula');
        const pagadoMat = pagosMat.reduce((sum, p) => sum + parseFloat(p.monto), 0);
        const debeMat = (tipo?.costo || 1500) - pagadoMat;
        if (debeMat > 0) deudaMatriculas += debeMat;
      });

      const deudaLibros = libros.reduce((sum, l) => sum + parseFloat(l.saldo || 0), 0);
      document.getElementById('dash-deuda-total').textContent = Utils.money(deudaMatriculas + deudaLibros);

      const parciales = libros.filter(l => parseFloat(l.pagado) > 0 && parseFloat(l.saldo) > 0).length;
      document.getElementById('dash-pagos-parciales').textContent = parciales;

      // Lista deudores
      let htmlDeudores = '';
      alumnos.forEach(a => {
        const tipo = tipos.find(t => t.id == a.tipo_matricula_id);
        const pagosMat = pagos.filter(p => p.alumno_id == a.id && p.concepto === 'matricula');
        const pagadoMat = pagosMat.reduce((sum, p) => sum + parseFloat(p.monto), 0);
        const debeMat = (tipo?.costo || 1500) - pagadoMat;
        
        if (debeMat > 0) {
          htmlDeudores += `<div class="flex justify-between items-center p-3 bg-red-50 rounded-lg border-l-4 border-red-500">
            <div>
              <div class="font-semibold text-gray-800">${a.nombre}</div>
              <div class="text-xs text-gray-500">${tipo?.nombre || 'Regular'}</div>
            </div>
            <span class="font-bold text-red-600">${Utils.money(debeMat)}</span>
          </div>`;
        }
      });
      document.getElementById('dash-lista-deudores').innerHTML = htmlDeudores || '<p class="text-gray-400 text-center py-4">No hay deudas de matr√≠cula</p>';

      // Libros pendientes
      let htmlLibros = '';
      libros.filter(l => parseFloat(l.saldo) > 0).forEach(l => {
        const alumno = alumnos.find(a => a.id == l.alumno_id);
        htmlLibros += `<div class="flex justify-between items-center p-3 bg-amber-50 rounded-lg border-l-4 border-amber-500">
          <div>
            <div class="font-semibold text-gray-800">${l.titulo}</div>
            <div class="text-xs text-gray-500">${alumno?.nombre || 'N/A'}</div>
          </div>
          <div class="text-right">
            <div class="font-bold text-amber-600">${Utils.money(l.saldo)}</div>
            <div class="text-xs text-gray-500">de ${Utils.money(l.costo_total)}</div>
          </div>
        </div>`;
      });
      document.getElementById('dash-libros-pendientes').innerHTML = htmlLibros || '<p class="text-gray-400 text-center py-4">No hay libros pendientes</p>';
    }

    // === ALUMNOS ===
    function cargarSelects() {
      const niveles = DB.get('niveles') || [];
      const tipos = DB.get('tiposMatricula') || [];
      
      const optsNiveles = niveles.map(n => `<option value="${n.id}">${n.nombre}</option>`).join('');
      document.getElementById('alumno-nivel').innerHTML = '<option value="">Seleccionar...</option>' + optsNiveles;
      
      const optsTipos = tipos.map(t => `<option value="${t.id}">${t.nombre} - ${Utils.money(t.costo)}</option>`).join('');
      document.getElementById('alumno-tipo-matricula').innerHTML = '<option value="">Seleccionar...</option>' + optsTipos;
    }

    function getProximoNumero() {
      const alumnos = DB.get('alumnos') || [];
      if (alumnos.length === 0) return 1;
      return Math.max(...alumnos.map(a => parseInt(a.numero_anual) || 0)) + 1;
    }

    function guardarAlumno(e) {
      e.preventDefault();
      const alumnos = DB.get('alumnos') || [];
      const id = document.getElementById('alumno-id').value;
      
      const alumno = {
        id: id || Utils.id(),
        numero_anual: id ? document.getElementById('alumno-numero').value : getProximoNumero(),
        nombre: document.getElementById('alumno-nombre').value.toUpperCase(),
        cedula: document.getElementById('alumno-cedula').value,
        telefono: document.getElementById('alumno-telefono').value,
        edad: document.getElementById('alumno-edad').value,
        direccion: document.getElementById('alumno-direccion').value,
        nivel_id: document.getElementById('alumno-nivel').value,
        tipo_matricula_id: document.getElementById('alumno-tipo-matricula').value,
        fecha_inscripcion: document.getElementById('alumno-fecha').value,
        created_at: new Date().toISOString()
      };

      if (id) {
        const idx = alumnos.findIndex(a => a.id == id);
        alumnos[idx] = alumno;
        Utils.toast('Alumno actualizado');
      } else {
        alumnos.push(alumno);
        Utils.toast('Alumno registrado');
      }
      
      DB.set('alumnos', alumnos);
      resetFormAlumno();
      cargarAlumnos();
      actualizarDashboard();
    }

    function resetFormAlumno() {
      document.getElementById('form-alumno').reset();
      document.getElementById('alumno-id').value = '';
      document.getElementById('alumno-numero').value = '';
      document.getElementById('alumno-fecha').value = Utils.fecha();
      document.getElementById('titulo-form-alumno').textContent = 'Nuevo Alumno';
    }

    function editarAlumno(id) {
      const alumno = DB.get('alumnos').find(a => a.id == id);
      if (!alumno) return;

      document.getElementById('alumno-id').value = alumno.id;
      document.getElementById('alumno-numero').value = alumno.numero_anual;
      document.getElementById('alumno-nombre').value = alumno.nombre;
      document.getElementById('alumno-cedula').value = alumno.cedula;
      document.getElementById('alumno-telefono').value = alumno.telefono || '';
      document.getElementById('alumno-edad').value = alumno.edad || '';
      document.getElementById('alumno-direccion').value = alumno.direccion || '';
      document.getElementById('alumno-nivel').value = alumno.nivel_id;
      document.getElementById('alumno-tipo-matricula').value = alumno.tipo_matricula_id;
      document.getElementById('alumno-fecha').value = alumno.fecha_inscripcion;
      
      document.getElementById('titulo-form-alumno').textContent = 'Editar Alumno';
      window.scrollTo(0, 0);
    }

    function eliminarAlumno(id) {
      if (!Utils.confirm('¬øEliminar este alumno? Se perder√°n todos sus datos.')) return;
      
      let alumnos = DB.get('alumnos').filter(a => a.id != id);
      let libros = DB.get('libros').filter(l => l.alumno_id != id);
      let pagos = DB.get('pagos').filter(p => p.alumno_id != id);
      
      DB.set('alumnos', alumnos);
      DB.set('libros', libros);
      DB.set('pagos', pagos);
      
      Utils.toast('Alumno eliminado');
      cargarAlumnos();
      actualizarDashboard();
    }

    function cargarAlumnos() {
      cargarSelects();
      const alumnos = DB.get('alumnos') || [];
      const niveles = DB.get('niveles') || [];
      const tipos = DB.get('tiposMatricula') || [];
      const pagos = DB.get('pagos') || [];

      let html = '';
      alumnos.forEach(a => {
        const nivel = niveles.find(n => n.id == a.nivel_id)?.nombre || '-';
        const tipo = tipos.find(t => t.id == a.tipo_matricula_id);
        const pagosMat = pagos.filter(p => p.alumno_id == a.id && p.concepto === 'matricula');
        const pagadoMat = pagosMat.reduce((sum, p) => sum + parseFloat(p.monto), 0);
        const debeMat = (tipo?.costo || 1500) - pagadoMat;
        
        html += `<tr class="hover:bg-gray-50">
          <td class="px-4 py-3 font-medium">${a.numero_anual}</td>
          <td class="px-4 py-3">${a.nombre}</td>
          <td class="px-4 py-3 text-sm">${a.cedula}</td>
          <td class="px-4 py-3 text-sm">${nivel}</td>
          <td class="px-4 py-3 text-sm">${tipo?.nombre || 'Regular'}</td>
          <td class="px-4 py-3">
            ${debeMat > 0 ? `<span class="status-badge status-pendiente">${Utils.money(debeMat)}</span>` : '<span class="status-badge status-pagado">Al d√≠a</span>'}
          </td>
          <td class="px-4 py-3">
            <button onclick="editarAlumno('${a.id}')" class="text-blue-600 hover:text-blue-800 mr-2" title="Editar">
              <i class="fas fa-edit"></i>
            </button>
            <button onclick="eliminarAlumno('${a.id}')" class="text-red-600 hover:text-red-800" title="Eliminar">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>`;
      });
      
      document.getElementById('tabla-alumnos').innerHTML = html || '<tr><td colspan="7" class="text-center py-4 text-gray-500">No hay alumnos registrados</td></tr>';
    }

    function buscarAlumnos() {
      const term = document.getElementById('buscar-alumno').value.toLowerCase();
      const rows = document.querySelectorAll('#tabla-alumnos tr');
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(term) ? '' : 'none';
      });
    }

    // === PAGOS ===
    function buscarAlumnoParaPago() {
      const term = document.getElementById('pago-buscar').value.toLowerCase();
      const alumnos = DB.get('alumnos') || [];
      const div = document.getElementById('pago-resultados');
      
      if (term.length < 2) {
        div.innerHTML = '';
        return;
      }
      
      const filtrados = alumnos.filter(a => 
        a.nombre.toLowerCase().includes(term) || 
        a.cedula.includes(term)
      );
      
      div.innerHTML = filtrados.map(a => `
        <div onclick="seleccionarAlumnoPago('${a.id}')" class="p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-blue-50 transition border border-gray-200">
          <div class="font-semibold text-gray-800">${a.nombre}</div>
          <div class="text-sm text-gray-500">C√©dula: ${a.cedula}</div>
        </div>
      `).join('');
    }

    function seleccionarAlumnoPago(id) {
      const alumno = DB.get('alumnos').find(a => a.id == id);
      const tipo = DB.get('tiposMatricula').find(t => t.id == alumno.tipo_matricula_id);
      
      document.getElementById('pago-alumno-id').value = id;
      document.getElementById('pago-alumno-info').textContent = `${alumno.nombre} (N¬∞ ${alumno.numero_anual})`;
      document.getElementById('pago-alumno-detalle').textContent = `Tipo: ${tipo?.nombre || 'Regular'} | C√©dula: ${alumno.cedula}`;
      document.getElementById('pago-fecha').value = Utils.fecha();
      
      document.getElementById('panel-pago').classList.remove('hidden');
      document.getElementById('pago-resultados').innerHTML = '';
      document.getElementById('pago-buscar').value = '';
      
      cambiarConceptoPago();
    }

    function cambiarConceptoPago() {
      const concepto = document.getElementById('pago-concepto').value;
      const campoMes = document.getElementById('campo-mes');
      const campoLibro = document.getElementById('campo-libro');
      
      campoMes.classList.add('hidden');
      campoLibro.classList.add('hidden');
      
      if (concepto === 'mensualidad') {
        campoMes.classList.remove('hidden');
        document.getElementById('pago-mes').value = new Date().getMonth() + 1;
      } else if (concepto === 'libro') {
        campoLibro.classList.remove('hidden');
        cargarSelectLibros();
      } else if (concepto === 'matricula') {
        const alumnoId = document.getElementById('pago-alumno-id').value;
        const alumno = DB.get('alumnos').find(a => a.id == alumnoId);
        const tipo = DB.get('tiposMatricula').find(t => t.id == alumno.tipo_matricula_id);
        const pagos = DB.get('pagos').filter(p => p.alumno_id == alumnoId && p.concepto === 'matricula');
        const pagado = pagos.reduce((sum, p) => sum + parseFloat(p.monto), 0);
        const saldo = (tipo?.costo || 1500) - pagado;
        document.getElementById('pago-monto').value = saldo > 0 ? saldo : 0;
      }
    }

    function cargarSelectLibros() {
      const alumnoId = document.getElementById('pago-alumno-id').value;
      const libros = DB.get('libros').filter(l => l.alumno_id == alumnoId && parseFloat(l.saldo) > 0);
      
      const opts = libros.map(l => `<option value="${l.id}">${l.titulo} (Saldo: ${Utils.money(l.saldo)})</option>`).join('');
      document.getElementById('pago-libro-id').innerHTML = '<option value="">Seleccionar libro...</option>' + opts;
      
      if (libros.length === 0) {
        document.getElementById('pago-libro-id').innerHTML = '<option value="">No hay libros pendientes</option>';
      }
    }

    function actualizarSaldoLibro() {
      const libroId = document.getElementById('pago-libro-id').value;
      if (!libroId) {
        document.getElementById('info-libro-saldo').classList.add('hidden');
        return;
      }
      
      const libro = DB.get('libros').find(l => l.id == libroId);
      document.getElementById('libro-costo-total').textContent = Utils.money(libro.costo_total);
      document.getElementById('libro-pagado').textContent = Utils.money(libro.pagado);
      document.getElementById('libro-saldo').textContent = Utils.money(libro.saldo);
      document.getElementById('pago-monto').value = libro.saldo;
      document.getElementById('info-libro-saldo').classList.remove('hidden');
    }

    function guardarPago(e) {
      e.preventDefault();
      const pagos = DB.get('pagos') || [];
      const alumnoId = document.getElementById('pago-alumno-id').value;
      const concepto = document.getElementById('pago-concepto').value;
      const monto = parseFloat(document.getElementById('pago-monto').value);
      
      if (!alumnoId || !concepto || !monto) {
        Utils.toast('Complete todos los campos obligatorios', 'error');
        return;
      }
      
      const pago = {
        id: Utils.id(),
        alumno_id: alumnoId,
        concepto: concepto,
        monto: monto,
        fecha: document.getElementById('pago-fecha').value,
        comentarios: document.getElementById('pago-comentarios').value,
        mes: concepto === 'mensualidad' ? document.getElementById('pago-mes').value : null,
        libro_id: concepto === 'libro' ? document.getElementById('pago-libro-id').value : null,
        created_at: new Date().toISOString()
      };
      
      pagos.push(pago);
      DB.set('pagos', pagos);
      
      // Si es pago de libro, actualizar saldo
      if (concepto === 'libro' && pago.libro_id) {
        const libros = DB.get('libros');
        const libro = libros.find(l => l.id == pago.libro_id);
        libro.pagado = parseFloat(libro.pagado) + monto;
        libro.saldo = parseFloat(libro.saldo) - monto;
        libro.pagos = libro.pagos || [];
        libro.pagos.push({
          fecha: pago.fecha,
          monto: monto,
          comentarios: pago.comentarios
        });
        DB.set('libros', libros);
      }
      
      Utils.toast('Pago registrado correctamente');
      cerrarPanelPago();
      cargarPagos();
      actualizarDashboard();
    }

    function cerrarPanelPago() {
      document.getElementById('form-pago').reset();
      document.getElementById('panel-pago').classList.add('hidden');
      document.getElementById('info-libro-saldo').classList.add('hidden');
    }

    function cargarPagos() {
      const pagos = DB.get('pagos') || [];
      const alumnos = DB.get('alumnos') || [];
      
      const sorted = pagos.sort((a, b) => new Date(b.fecha) - new Date(a.fecha)).slice(0, 50);
      
      let html = '';
      sorted.forEach(p => {
        const alumno = alumnos.find(a => a.id == p.alumno_id);
        html += `<tr class="hover:bg-gray-50">
          <td class="px-4 py-3 text-sm">${Utils.fechaDisplay(p.fecha)}</td>
          <td class="px-4 py-3 font-medium">${alumno?.nombre || 'N/A'}</td>
          <td class="px-4 py-3 text-sm capitalize">
            <span class="px-2 py-1 rounded text-xs font-bold ${getColorConcepto(p.concepto)}">
              ${p.concepto}
            </span>
          </td>
          <td class="px-4 py-3 font-bold text-green-600">${Utils.money(p.monto)}</td>
          <td class="px-4 py-3 text-sm text-gray-600 max-w-xs truncate">${p.comentarios || '-'}</td>
          <td class="px-4 py-3">
            <button onclick="editarPago('${p.id}')" class="text-blue-600 hover:text-blue-800 mr-2">
              <i class="fas fa-edit"></i>
            </button>
            <button onclick="eliminarPago('${p.id}')" class="text-red-600 hover:text-red-800">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>`;
      });
      
      document.getElementById('tabla-pagos').innerHTML = html || '<tr><td colspan="6" class="text-center py-4 text-gray-500">No hay pagos registrados</td></tr>';
    }

    function getColorConcepto(c) {
      const colors = {
        matricula: 'bg-purple-100 text-purple-800',
        mensualidad: 'bg-blue-100 text-blue-800',
        libro: 'bg-amber-100 text-amber-800',
        examen: 'bg-pink-100 text-pink-800',
        otro: 'bg-gray-100 text-gray-800'
      };
      return colors[c] || colors.otro;
    }

    function editarPago(id) {
      const pago = DB.get('pagos').find(p => p.id == id);
      if (!pago) return;
      
      document.getElementById('edit-pago-id').value = pago.id;
      document.getElementById('edit-pago-monto').value = pago.monto;
      document.getElementById('edit-pago-fecha').value = pago.fecha;
      document.getElementById('edit-pago-comentarios').value = pago.comentarios || '';
      
      document.getElementById('modal-editar-pago').classList.add('active');
    }

    function actualizarPago(e) {
      e.preventDefault();
      const pagos = DB.get('pagos');
      const id = document.getElementById('edit-pago-id').value;
      const idx = pagos.findIndex(p => p.id == id);
      
      const montoAnterior = parseFloat(pagos[idx].monto);
      const montoNuevo = parseFloat(document.getElementById('edit-pago-monto').value);
      const diferencia = montoNuevo - montoAnterior;
      
      pagos[idx].monto = montoNuevo;
      pagos[idx].fecha = document.getElementById('edit-pago-fecha').value;
      pagos[idx].comentarios = document.getElementById('edit-pago-comentarios').value;
      
      // Si es libro, ajustar saldo
      if (pagos[idx].concepto === 'libro' && pagos[idx].libro_id) {
        const libros = DB.get('libros');
        const libro = libros.find(l => l.id == pagos[idx].libro_id);
        libro.pagado = parseFloat(libro.pagado) + diferencia;
        libro.saldo = parseFloat(libro.saldo) - diferencia;
        DB.set('libros', libros);
      }
      
      DB.set('pagos', pagos);
      Utils.toast('Pago actualizado');
      cerrarModal('modal-editar-pago');
      cargarPagos();
      actualizarDashboard();
    }

    function eliminarPago(id) {
      if (!Utils.confirm('¬øEliminar este pago?')) return;
      
      const pagos = DB.get('pagos');
      const pago = pagos.find(p => p.id == id);
      
      // Si es libro, revertir
      if (pago.concepto === 'libro' && pago.libro_id) {
        const libros = DB.get('libros');
        const libro = libros.find(l => l.id == pago.libro_id);
        libro.pagado = parseFloat(libro.pagado) - parseFloat(pago.monto);
        libro.saldo = parseFloat(libro.saldo) + parseFloat(pago.monto);
        DB.set('libros', libros);
      }
      
      DB.set('pagos', pagos.filter(p => p.id != id));
      Utils.toast('Pago eliminado');
      cargarPagos();
      actualizarDashboard();
    }

    // === LIBROS ===
    function buscarAlumnoParaLibro() {
      const term = document.getElementById('libro-buscar-alumno').value.toLowerCase();
      const alumnos = DB.get('alumnos') || [];
      const div = document.getElementById('libro-resultados-alumno');
      
      if (term.length < 2) {
        div.innerHTML = '';
        return;
      }
      
      const filtrados = alumnos.filter(a => a.nombre.toLowerCase().includes(term));
      div.innerHTML = filtrados.map(a => `
        <div onclick="seleccionarAlumnoLibro('${a.id}')" class="p-2 bg-gray-50 rounded cursor-pointer hover:bg-blue-50 border border-gray-200">
          <div class="font-medium">${a.nombre}</div>
          <div class="text-xs text-gray-500">${a.cedula}</div>
        </div>
      `).join('');
    }

    function seleccionarAlumnoLibro(id) {
      const alumno = DB.get('alumnos').find(a => a.id == id);
      document.getElementById('libro-alumno-id').value = id;
      document.getElementById('libro-alumno-nombre').textContent = alumno.nombre;
      document.getElementById('form-libro').classList.remove('hidden');
      document.getElementById('libro-resultados-alumno').innerHTML = '';
      document.getElementById('libro-buscar-alumno').value = '';
    }

    function calcularSaldoInicial() {
      const costo = parseFloat(document.getElementById('libro-costo').value) || 0;
      const abono = parseFloat(document.getElementById('libro-abono').value) || 0;
      document.getElementById('libro-saldo-inicial').textContent = Utils.money(costo - abono);
    }

    function asignarLibro(e) {
      e.preventDefault();
      const libros = DB.get('libros') || [];
      
      const costo = parseFloat(document.getElementById('libro-costo').value);
      const abono = parseFloat(document.getElementById('libro-abono').value) || 0;
      const alumnoId = document.getElementById('libro-alumno-id').value;
      const alumno = DB.get('alumnos').find(a => a.id == alumnoId);
      
      const libro = {
        id: Utils.id(),
        alumno_id: alumnoId,
        alumno_nombre: alumno.nombre,
        alumno_numero: alumno.numero_anual,
        titulo: document.getElementById('libro-titulo').value,
        costo_total: costo,
        pagado: abono,
        saldo: costo - abono,
        observaciones: document.getElementById('libro-observaciones').value,
        pagos: abono > 0 ? [{
          fecha: Utils.fecha(),
          monto: abono,
          comentarios: 'Abono inicial al asignar'
        }] : [],
        created_at: new Date().toISOString()
      };
      
      libros.push(libro);
      DB.set('libros', libros);
      
      // Registrar pago si hubo abono
      if (abono > 0) {
        const pagos = DB.get('pagos') || [];
        pagos.push({
          id: Utils.id(),
          alumno_id: alumnoId,
          concepto: 'libro',
          monto: abono,
          fecha: Utils.fecha(),
          comentarios: `Abono inicial - ${libro.titulo}`,
          libro_id: libro.id,
          created_at: new Date().toISOString()
        });
        DB.set('pagos', pagos);
      }
      
      Utils.toast('Libro asignado correctamente');
      document.getElementById('form-libro').reset();
      document.getElementById('form-libro').classList.add('hidden');
      cargarLibros();
      actualizarDashboard();
    }

    function cargarLibros() {
      const libros = DB.get('libros') || [];
      const alumnos = DB.get('alumnos') || [];
      
      // Stats
      const total = libros.length;
      const pagados = libros.filter(l => parseFloat(l.saldo) === 0).length;
      const parciales = libros.filter(l => parseFloat(l.pagado) > 0 && parseFloat(l.saldo) > 0).length;
      const deudaTotal = libros.reduce((sum, l) => sum + parseFloat(l.saldo || 0), 0);
      
      document.getElementById('stat-total-libros').textContent = total;
      document.getElementById('stat-libros-pagados').textContent = pagados;
      document.getElementById('stat-libros-parciales').textContent = parciales;
      document.getElementById('stat-deuda-libros').textContent = Utils.money(deudaTotal);
      
      // Tabla
      let html = '';
      libros.forEach(l => {
        const alumno = alumnos.find(a => a.id == l.alumno_id);
        const porcentaje = (parseFloat(l.pagado) / parseFloat(l.costo_total)) * 100;
        let estado = '';
        let estadoClass = '';
        
        if (parseFloat(l.saldo) === 0) {
          estado = 'Pagado';
          estadoClass = 'status-pagado';
        } else if (parseFloat(l.pagado) > 0) {
          estado = 'Parcial';
          estadoClass = 'status-parcial';
        } else {
          estado = 'Pendiente';
          estadoClass = 'status-pendiente';
        }
        
        html += `<tr class="hover:bg-gray-50">
          <td class="px-4 py-3 font-medium">${alumno?.nombre || 'N/A'}</td>
          <td class="px-4 py-3">${l.titulo}</td>
          <td class="px-4 py-3">${Utils.money(l.costo_total)}</td>
          <td class="px-4 py-3 text-green-600">${Utils.money(l.pagado)}</td>
          <td class="px-4 py-3 text-red-600 font-bold">${Utils.money(l.saldo)}</td>
          <td class="px-4 py-3"><span class="status-badge ${estadoClass}">${estado}</span></td>
          <td class="px-4 py-3">
            ${parseFloat(l.saldo) > 0 ? `<button onclick="abrirModalAbono('${l.id}')" class="text-blue-600 hover:text-blue-800 mr-2" title="Abonar"><i class="fas fa-plus-circle"></i></button>` : ''}
            <button onclick="verHistorialLibro('${l.id}')" class="text-green-600 hover:text-green-800 mr-2" title="Ver historial"><i class="fas fa-history"></i></button>
            <button onclick="eliminarLibro('${l.id}')" class="text-red-600 hover:text-red-800" title="Eliminar"><i class="fas fa-trash"></i></button>
          </td>
        </tr>`;
      });
      
      document.getElementById('tabla-libros').innerHTML = html || '<tr><td colspan="7" class="text-center py-4 text-gray-500">No hay libros registrados</td></tr>';
    }

    function abrirModalAbono(libroId) {
      const libro = DB.get('libros').find(l => l.id == libroId);
      document.getElementById('abono-libro-id').value = libroId;
      document.getElementById('abono-info-libro').innerHTML = `
        <div class="font-bold text-lg">${libro.titulo}</div>
        <div class="text-sm text-gray-600">Saldo pendiente: <span class="font-bold text-red-600 text-lg">${Utils.money(libro.saldo)}</span></div>
      `;
      document.getElementById('abono-monto').value = libro.saldo;
      document.getElementById('abono-monto').max = libro.saldo;
      document.getElementById('modal-abono-libro').classList.add('active');
    }

    function registrarAbonoLibro(e) {
      e.preventDefault();
      const libros = DB.get('libros');
      const libroId = document.getElementById('abono-libro-id').value;
      const libro = libros.find(l => l.id == libroId);
      const monto = parseFloat(document.getElementById('abono-monto').value);
      
      if (monto > parseFloat(libro.saldo)) {
        Utils.toast('El abono no puede superar el saldo', 'error');
        return;
      }
      
      libro.pagado = parseFloat(libro.pagado) + monto;
      libro.saldo = parseFloat(libro.saldo) - monto;
      libro.pagos.push({
        fecha: Utils.fecha(),
        monto: monto,
        comentarios: document.getElementById('abono-comentarios').value
      });
      
      DB.set('libros', libros);
      
      // Registrar en pagos
      const pagos = DB.get('pagos') || [];
      pagos.push({
        id: Utils.id(),
        alumno_id: libro.alumno_id,
        concepto: 'libro',
        monto: monto,
        fecha: Utils.fecha(),
        comentarios: `Abono - ${libro.titulo}: ${document.getElementById('abono-comentarios').value}`,
        libro_id: libro.id,
        created_at: new Date().toISOString()
      });
      DB.set('pagos', pagos);
      
      Utils.toast('Abono registrado');
      cerrarModal('modal-abono-libro');
      cargarLibros();
      actualizarDashboard();
    }

    function verHistorialLibro(libroId) {
      const libro = DB.get('libros').find(l => l.id == libroId);
      document.getElementById('historial-libro-info').innerHTML = `
        <div class="font-bold">${libro.titulo}</div>
        <div class="text-sm">Costo total: ${Utils.money(libro.costo_total)} | Pagado: ${Utils.money(libro.pagado)} | Saldo: ${Utils.money(libro.saldo)}</div>
      `;
      
      let html = '';
      libro.pagos.forEach((p, idx) => {
        html += `<div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
          <div>
            <div class="font-medium">${Utils.fechaDisplay(p.fecha)}</div>
            <div class="text-sm text-gray-600">${p.comentarios || ''}</div>
          </div>
          <span class="font-bold text-green-600">${Utils.money(p.monto)}</span>
        </div>`;
      });
      
      document.getElementById('historial-libro-lista').innerHTML = html || '<p class="text-gray-500 text-center">Sin pagos registrados</p>';
      document.getElementById('modal-historial-libro').classList.add('active');
    }

    function eliminarLibro(id) {
      if (!Utils.confirm('¬øEliminar este libro?')) return;
      DB.set('libros', DB.get('libros').filter(l => l.id != id));
      Utils.toast('Libro eliminado');
      cargarLibros();
      actualizarDashboard();
    }

    // === REPORTES ===
    function generarReporte() {
      const desde = document.getElementById('reporte-desde').value;
      const hasta = document.getElementById('reporte-hasta').value;
      const concepto = document.getElementById('reporte-concepto').value;
      
      if (!desde || !hasta) {
        Utils.toast('Seleccione fechas', 'error');
        return;
      }
      
      let pagos = DB.get('pagos') || [];
      pagos = pagos.filter(p => p.fecha >= desde && p.fecha <= hasta);
      if (concepto !== 'todos') {
        pagos = pagos.filter(p => p.concepto === concepto);
      }
      
      const total = pagos.reduce((sum, p) => sum + parseFloat(p.monto), 0);
      document.getElementById('reporte-total').textContent = Utils.money(total);
      document.getElementById('reporte-cantidad').textContent = pagos.length;
      document.getElementById('reporte-promedio').textContent = Utils.money(pagos.length ? total / pagos.length : 0);
      
      const alumnos = DB.get('alumnos') || [];
      let html = '';
      pagos.forEach(p => {
        const alumno = alumnos.find(a => a.id == p.alumno_id);
        html += `<tr class="hover:bg-gray-50">
          <td class="px-4 py-3 text-sm">${Utils.fechaDisplay(p.fecha)}</td>
          <td class="px-4 py-3">${alumno?.nombre || 'N/A'}</td>
          <td class="px-4 py-3 capitalize">${p.concepto}</td>
          <td class="px-4 py-3 font-bold">${Utils.money(p.monto)}</td>
          <td class="px-4 py-3 text-sm text-gray-600">${p.comentarios || '-'}</td>
        </tr>`;
      });
      
      document.getElementById('tabla-reporte').innerHTML = html || '<tr><td colspan="5" class="text-center py-4 text-gray-500">No hay resultados</td></tr>';
      document.getElementById('resultado-reporte').classList.remove('hidden');
    }

    // === BACKUP / EXPORT ===
    function exportarSeccion(seccion) {
      let data, filename;
      
      if (seccion === 'completo') {
        data = {
          version: '3.0',
          fecha_exportacion: new Date().toISOString(),
          niveles: DB.get('niveles'),
          alumnos: DB.get('alumnos'),
          libros: DB.get('libros'),
          pagos: DB.get('pagos'),
          gastos: DB.get('gastos'),
          tiposMatricula: DB.get('tiposMatricula')
        };
        filename = `alei_backup_completo_${Utils.fecha()}.json`;
      } else {
        data = DB.get(seccion) || [];
        filename = `alei_${seccion}_${Utils.fecha()}.json`;
      }
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      Utils.toast('Archivo descargado');
    }

    function importarDatos(input) {
      const file = input.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = JSON.parse(e.target.result);
          const fusion = document.getElementById('importar-modo').checked;
          
          if (data.version) {
            // Es backup completo
            if (fusion) {
              // Fusi√≥n de datos
              const actuales = {
                alumnos: DB.get('alumnos') || [],
                libros: DB.get('libros') || [],
                pagos: DB.get('pagos') || [],
                gastos: DB.get('gastos') || [],
                niveles: DB.get('niveles') || [],
                tiposMatricula: DB.get('tiposMatricula') || []
              };
              
              DB.set('alumnos', [...actuales.alumnos, ...(data.alumnos || [])]);
              DB.set('libros', [...actuales.libros, ...(data.libros || [])]);
              DB.set('pagos', [...actuales.pagos, ...(data.pagos || [])]);
              DB.set('gastos', [...actuales.gastos, ...(data.gastos || [])]);
              Utils.toast('Datos fusionados correctamente');
            } else {
              // Reemplazo total
              if (confirm('Esto reemplazar√° TODOS los datos existentes. ¬øContinuar?')) {
                DB.set('niveles', data.niveles || []);
                DB.set('alumnos', data.alumnos || []);
                DB.set('libros', data.libros || []);
                DB.set('pagos', data.pagos || []);
                DB.set('gastos', data.gastos || []);
                DB.set('tiposMatricula', data.tiposMatricula || []);
                Utils.toast('Backup restaurado');
              }
            }
          } else if (Array.isArray(data)) {
            // Es una secci√≥n espec√≠fica
            const key = Object.keys({niveles:1, alumnos:1, libros:1, pagos:1, gastos:1}).find(k => file.name.includes(k)) || 'datos';
            if (fusion) {
              const actuales = DB.get(key) || [];
              DB.set(key, [...actuales, ...data]);
            } else {
              DB.set(key, data);
            }
            Utils.toast(`${key} importados`);
          }
          
          actualizarDashboard();
          cargarAlumnos();
        } catch (err) {
          Utils.toast('Error al importar: ' + err.message, 'error');
        }
      };
      reader.readAsText(file);
      input.value = '';
    }

    // === RESET SISTEMA ===
    function iniciarReset() {
      document.getElementById('reset-paso-1').classList.add('hidden');
      document.getElementById('reset-paso-2').classList.remove('hidden');
    }

    function cancelarReset() {
      document.getElementById('reset-paso-1').classList.remove('hidden');
      document.getElementById('reset-paso-2').classList.add('hidden');
      document.getElementById('reset-confirmacion').value = '';
    }

    function ejecutarReset() {
      const confirmacion = document.getElementById('reset-confirmacion').value;
      if (confirmacion !== 'ELIMINAR TODO') {
        Utils.toast('Texto de confirmaci√≥n incorrecto', 'error');
        return;
      }
      
      // Exportar backup autom√°tico antes de borrar
      const backup = {
        version: '3.0',
        fecha_exportacion: new Date().toISOString(),
        niveles: DB.get('niveles'),
        alumnos: DB.get('alumnos'),
        libros: DB.get('libros'),
        pagos: DB.get('pagos'),
        gastos: DB.get('gastos'),
        tiposMatricula: DB.get('tiposMatricula')
      };
      
      const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `alei_backup_antes_reset_${Utils.fecha()}.json`;
      a.click();
      
      // Limpiar todo
      localStorage.removeItem('alei_niveles');
      localStorage.removeItem('alei_alumnos');
      localStorage.removeItem('alei_libros');
      localStorage.removeItem('alei_pagos');
      localStorage.removeItem('alei_gastos');
      DB.init();
      
      Utils.toast('Sistema reseteado. Backup descargado autom√°ticamente.');
      cancelarReset();
      actualizarDashboard();
      cargarAlumnos();
    }

    function cerrarModal(id) {
      document.getElementById(id).classList.remove('active');
    }

    // === INICIALIZACI√ìN ===
    document.addEventListener('DOMContentLoaded', () => {
      DB.init();
      document.getElementById('alumno-fecha').value = Utils.fecha();
      document.getElementById('pago-fecha').value = Utils.fecha();
      
      // Actualizar hora
      setInterval(() => {
        const now = new Date();
        document.getElementById('current-time').textContent = now.toLocaleTimeString('es-UY');
        document.getElementById('current-date').textContent = now.toLocaleDateString('es-UY', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
      }, 1000);
      
      actualizarDashboard();
      cargarAlumnos();
      
      // Cerrar modales al hacer click fuera
      document.querySelectorAll('.modal').forEach(m => {
        m.addEventListener('click', (e) => {
          if (e.target === m) m.classList.remove('active');
        });
      });
    });
  </script>
</body>
</html>
